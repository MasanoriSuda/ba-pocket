# Requirements (0004 Implement EventLog and KPI Dashboard)

## 1. 目的
PoC検証のためにEventLogを端末内へ保存できるようにし、端末内でKPI一覧を最小構成で確認できる状態にする。

## 2. 変更・追加する機能
- EventLogの記録（端末内保存）
- EventLogから算出したKPIの簡易集計画面（KPI一覧）

## 3. ユーザーストーリー
1. PoC実施者として、端末内でKPI一覧を見て現状の達成度を把握したい
2. 実装者として、EventLogが定義通りに記録されていることを確認したい

## 4. 要件（機能）
### 4.1 EventLog
- 0003で定義したEventLogをすべて記録する
- 必須フィールド: `user_id`, `session_id`, `consultation_id`, `timestamp`, `event_type`
- 主要フィールドは該当イベントで保存する（JSON可）
- `user_id` は端末内生成の匿名UUID（再インストールでリセット）
- EventLogはHiveに保存する（PoCでは検索/集計が中心でリレーション不要のため）

### 4.2 KPI一覧（最小）
- 端末内でKPI一覧を表示できる
- 表示対象:
  - 問診完了率
  - 提案到達率
  - 提案実行率（all / all+partial）
  - 2回目利用率（7日以内）
  - 不安低減の平均
  - 紹介意向の平均
- KPIの算出式は 0003 の定義に準拠する
- KPIのデフォルト期間は直近14日（rolling 14 days）とする（全期間は任意）
- 率KPIは「値（%）＋分子/分母」を併記する
  - 例: 問診完了率 62%（31/50）
- 同一 `consultation_id` の重複イベントは 0003 の集計ルールに従い最初の1回のみ採用する

### 4.3 画面導線（最小）
- Home もしくは 設定画面からKPI一覧に遷移できる

### 4.4 運用補助（任意）
- KPI画面に「データリセット（端末内削除）」ボタンを設置してもよい（確認ダイアログ付き）

## 5. 受け入れ条件
- EventLogが端末内に保存される
- KPI一覧が端末内で表示できる
- KPI算出式が 0003 の定義と一致する
- 端末内のみで完結し、外部送信は行わない

## 6. 制約事項 / 非対象
- 外部分析基盤への送信はしない
- 個人情報は収集しない
- KPI一覧はPoC用の簡易表示のみ（エクスポートや共有は対象外）
